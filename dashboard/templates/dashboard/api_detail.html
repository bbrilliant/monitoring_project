{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détails API - {{ api.name }}</title>
    <link href="{% static 'dashboard/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'dashboard/js/chart.umd.js' %}"></script>
    <style>
        .status-up {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
        }
        .status-down {
            background-color: #dc3545;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
        }
        .chart-container {
            max-width: 400px;
            margin: 30px auto;
        }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/">API MONITORING DASHBOARD</a>
  </div>
</nav>

<div class="container py-5">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <h4 class="card-title text-center fw-bold mb-3">{{ api.name }}</h4>
      <p><strong>URL :</strong> {{ api.url }}</p>

      {% if api_info.status == "UP" %}
        <p><strong>Statut :</strong> <span class="status-up">UP</span></p>
      {% else %}
        <p><strong>Statut :</strong> <span class="status-down">DOWN</span></p>
      {% endif %}

      <hr>

      <h5 class="fw-bold">Stockage :</h5>
      {% if api_info.disk_status and api_info.disk_status != "N/A" %}
        <p><strong>Statut :</strong> {{ api_info.disk_status }}</p>
        <p><strong>Espace total :</strong> {{ api_info.disk_total_gb }} Go</p>
        <p><strong>Espace utilisé :</strong> {{ api_info.disk_used_gb }} Go</p>
        <p><strong>Espace libre :</strong> {{ api_info.disk_free_gb }} Go</p>

        <div class="chart-container">
            <canvas id="diskChart"></canvas>
        </div>

        <script>
            const ctx = document.getElementById('diskChart');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Utilisé (Go)', 'Libre (Go)'],
                    datasets: [{
                        data: [{{ api_info.disk_used_gb }}, {{ api_info.disk_free_gb }}],
                        backgroundColor: ['#dc3545', '#28a745'],
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Répartition du stockage'
                        }
                    }
                }
            });
        </script>

      {% else %}
        <p>Informations sur le stockage non disponibles.</p>
      {% endif %}
    </div>
  </div>
</div>

<script src="{% static 'dashboard/js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>
