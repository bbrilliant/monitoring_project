{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détails API - {{ api.name }}</title>
    <link href="{% static 'dashboard/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'dashboard/js/chart.umd.min.js' %}"></script>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark px-3">
  <a class="navbar-brand" href="/">Dashboard</a>
  <a href="/admin/" class="btn btn-success btn-sm">Admin</a>
</nav>

<div class="container py-4">
  <h2>Détails de l’API : {{ api.name }}</h2>
  <p><strong>URL :</strong> <a href="{{ api.url }}" target="_blank">{{ api.name }}</a></p>
  <p><strong>Statut :</strong> 
    {% if health.status == "UP" %}
      <span class="badge bg-success">UP</span>
    {% else %}
      <span class="badge bg-danger">DOWN</span>
    {% endif %}
  </p>
  <p><strong>Stockage :</strong>
    {% if health.disk_total > 0 %}
      {{ health.disk_free|divisibleby:1073741824 }} Go libres / {{ health.disk_total|divisibleby:1073741824 }} Go
    {% else %}
      Non disponible
    {% endif %}
  </p>

  <div class="card mt-3">
    <div class="card-body">
      <h5 class="card-title text-center">Stockage</h5>
      <canvas id="storageChart" height="200"></canvas>
    </div>
  </div>

  <a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">Retour</a>
</div>

<script>
const total = {{ health.disk_total|default:0 }};
const free = {{ health.disk_free|default:0 }};
const used = total - free;

const ctx = document.getElementById("storageChart").getContext("2d");
new Chart(ctx, {
  type: "doughnut",
  data: {
    labels: ["Utilisé (Go)", "Libre (Go)"],
    datasets: [{
      data: [(used / (1024**3)).toFixed(2), (free / (1024**3)).toFixed(2)],
      backgroundColor: ["#dc3545", "#28a745"]
    }]
  },
  options: { responsive: true, plugins: { legend: { position: "bottom" } } }
});
</script>
</body>
</html>
